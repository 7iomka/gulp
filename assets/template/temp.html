
                                                                                                                                                                                                                <!DOCTYPE html><title>
    unmandelboxing                                                                                                                                                                                              </title><body style="background-color: #000" onload='d=document;d.body.appendChild(c=d.createElement("canvas"));g=c.getContext("webgl")||c.getContext("experimental-webgl");sp=g.createProgram();function gs(t,s){g.shaderSource(t=g.createShader(t),s);g.compileShader(t);g.attachShader(sp,t);}gs(35633,"attribute vec2 P;void main(void){gl_Position=vec4(P,0.,1.);}");gs(35632,"precision mediump float;uniform vec4 I;Q Z(Q p,float a){return Q(cos(a)*p.y+sin(a)*p.x,cos(a)*p.x-sin(a)*p.y,p.z);}float F(Q P){float R=sin((I.x+P.z*0.01)*3.176)*.45+.5,S=3.4312-sin(I.x*0.1);vec4 p=vec4(P,1),o=p,s=vec4(S,S,S,abs(S))/R;for(int i=0;i<24;i++){if(i==3||i==7||i==11||i==15||i==19||i==23)R=sin((I.x+P.z*0.01+float(i)*0.25*sin(I.x*.012211154)*3.8)*3.176)*0.45+0.5;p.xyz=clamp(p.xyz,-1.,1.)*2.-p.xyz;float r2=dot(p.xyz,p.xyz);if(r2>1000.)break;p=p*clamp(max(R/r2,R),0.,1.)*s+o;}return((length(p.xyz)-abs(S-1.))/p.w-pow(abs(S),float(1-24)));}float D(Q p){Q c=Q(10.,10.,8.);p=mod(p,c)-.5*c;Q q=abs(Z(p,p.z*3.1415/10.*4.));float d2=max(q.z-10.,max((q.x*0.866025+q.y*0.5),q.y)-.08);p=Z(p,p.z*3.1415/10.*(length(p.xy)-3.)*sin(I.x*.01)*.8);return max(F(p),-d2);}Q R(Q p,Q d){float td=0.,rd=0.;for(int i=0;i<80;i++){if((rd=D(p))<pow(td,1.5)*.004)break;td+=rd;p+=d*rd;}float md=D(p),e=.0025;Q n=normalize(Q(D(p+Q(e,0,0))-D(p-Q(e,0,0)),D(p+Q(0,e,0))-D(p-Q(0,e,0)),D(p+Q(0,0,e))-D(p-Q(0,0,e))));e*=.5;float occ=1.+(D(p+n*.02+Q(-e,0,0))+D(p+n*.02+Q(+e,0,0))+D(p+n*.02+Q(0,-e,0))+D(p+n*.02+Q(0,e,0))+D(p+n*.02+Q(0,0,-e))+D(p+n*.02+Q(0,0,e))-.03)*20.;occ=clamp(occ,0.,1.);float br=(pow(clamp(dot(n,-normalize(d+Q(.3,-.9,.4)))*.6+.4, 0.,1.),2.7)*.8+.2)*occ/(td*.5+1.);float fog=clamp(1./(td*td*1.8+.4),0.,1.);return mix(Q(br,br/(td*td*.2+1.),br/(td+1.)),Q(0.,0.,0.),1.-fog);}void main(void){vec2 f=gl_FragCoord.xy;Q d=Q((f-vec2(213.,120.))/120.,1.);Q c=pow(R(Q(5.,5.,I.x*10.),normalize(d*Q(1.,1.,1.-(length(d.xy)*.9)))),Q(.6,.6,.6));gl_FragColor=vec4(pow(floor(c*Q(8.,8.,4.)+fract(f.x/4.+f.y/2.)/2.)/(Q(7.,7.,3.)),Q(1.5,1.5,1.5)),1.);}".split("Q").join("vec3"));g.linkProgram(sp);g.useProgram(sp);g.bindBuffer(34962,g.createBuffer());g.bufferData(34962,new Float32Array([i=-1,i,i,1,1,i,1,1]),35044);g.vertexAttribPointer(0,2,5126,0,0,0);g.enableVertexAttribArray(0);(u=function(t){W=innerWidth;H=innerHeight;s=(H/240)|0;g.viewport(0,0,w=c.width=426,h=c.height=240);c.style.cssText="position:fixed;width:"+(w*=s)+"px;height:"+(h*=s)+"px;left:"+((W-w)/2)+"px;top:"+((H-h)*.3)+"px;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor";g.uniform4f(g.getUniformLocation(sp,"I"),(t-30000)*.00002,0,0,0);g.drawArrays(5,0,4);requestAnimationFrame(u);})(0);'></body><!--

=========================================================

Distance field ray marching a heavily distorted Mandelbox
Output image is 426x240 pixels, using the RGBA332 palette
Everything is contained in this single 3524 byte document

4kb+sound: doodle.notch.net/unmandelboxing/withsound.html

- Markus Persson, January 2016
